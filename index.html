<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Boost Pro - Allena la Mente</title>
    <style>
        /* Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            min-height: 600px;
            overflow-y: auto;
        }

        .premium-badge {
            position: absolute;
            top: -10px;
            right: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            z-index: 10;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .title {
            font-size: 2em;
            color: #333;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            transition: transform 0.3s ease;
        }

        .stat-value:hover {
            transform: scale(1.1);
        }

        .hearts {
            color: #ff6b6b;
        }

        .coins {
            color: #ffd93d;
        }

        /* Categories */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .category-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .category-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            position: relative;
        }

        .category-card.locked::after {
            content: 'üîí';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.2em;
        }

        .category-icon {
            font-size: 3em;
            margin-bottom: 15px;
            transition: transform 0.3s ease;
        }

        .category-card:hover .category-icon {
            transform: scale(1.1);
        }

        .category-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .category-desc {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        /* Difficulty Selector */
        .difficulty-selector {
            margin: 20px 0;
            text-align: center;
        }

        .difficulty-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .difficulty-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Game Area */
        .game-area {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        /* Memory Game Specific */
        .memory-grid {
            display: grid;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            perspective: 1000px;
        }

        .memory-card {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 2em;
            color: white;
            transform-style: preserve-3d;
            position: relative;
        }

        .memory-card .card-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.4s;
            transform-style: preserve-3d;
        }

        .memory-card .card-front,
        .memory-card .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        .memory-card .card-front {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 2em;
        }

        .memory-card .card-back {
            background: #28a745;
            color: white;
            transform: rotateY(180deg);
            opacity: 0;
            transition: opacity 0.2s ease 0.2s;
        }

        .memory-card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .memory-card.flipped .card-back {
            opacity: 1;
        }

        .memory-card.matched {
            background: #ffd93d;
            cursor: default;
            opacity: 0.8;
            transform: scale(0.95);
        }

        /* Simon Game Specific */
        .simon-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-width: 300px;
            margin: 20px auto;
        }

        .simon-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 3em;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .simon-btn.red { background: #dc3545; }
        .simon-btn.blue { background: #007bff; }
        .simon-btn.green { background: #28a745; }
        .simon-btn.yellow { background: #ffc107; }

        .simon-btn.active {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            filter: brightness(1.2);
        }

        /* Question Card (Logic Game) */
        .question-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            width: 100%;
            transition: all 0.3s ease;
        }

        .question {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .option.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
            animation: pulseCorrect 0.5s;
        }

        .option.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
            animation: shake 0.5s;
        }

        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Power-ups */
        .power-ups {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .power-up {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .power-up:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .power-up.disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }

        /* Buttons */
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Ads and Premium Offers */
        .ad-banner {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .ad-banner:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .ad-banner::after {
            content: 'AD';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7em;
            background: rgba(0, 0, 0, 0.2);
            padding: 2px 5px;
            border-radius: 3px;
        }

        .premium-offer {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .premium-offer::before {
            content: '‚≠ê';
            position: absolute;
            top: -20px;
            left: -20px;
            font-size: 4em;
            opacity: 0.2;
            transform: rotate(-30deg);
        }

        .premium-offer::after {
            content: '‚≠ê';
            position: absolute;
            bottom: -20px;
            right: -20px;
            font-size: 4em;
            opacity: 0.2;
            transform: rotate(30deg);
        }

        .premium-offer h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
            position: relative;
            z-index: 1;
        }

        .premium-offer p {
            margin-bottom: 15px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .premium-offer .btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }

        .premium-offer .btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 10px;
            border-top: 1px solid #e9ecef;
            z-index: 999;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #666;
            min-width: 60px;
        }

        .nav-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-5px);
        }

        .nav-btn:hover {
            background: #e9ecef;
        }

        .nav-btn.active:hover {
            background: #667eea;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
            position: relative;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .modal p {
            color: #666;
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        /* Progress Bar (Timer for logic game) */
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 1s linear;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            z-index: 1001;
            animation: slideDown 0.3s, fadeOut 0.5s 2.5s forwards;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @keyframes slideDown {
            from { top: -50px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }

        /* Tutorial overlay */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1002;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tutorial-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .tutorial-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
                margin-bottom: 80px;
            }

            .title {
                font-size: 1.5em;
            }

            .category-grid {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                flex-direction: column;
                gap: 10px;
            }

            .stat-item {
                display: flex;
                justify-content: space-between;
                width: 100%;
            }

            .memory-card {
                width: 60px;
                height: 60px;
                font-size: 1.5em;
            }

            .simon-btn {
                width: 80px;
                height: 80px;
                font-size: 2em;
            }

            .buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }

            .nav-btn {
                min-width: 50px;
                font-size: 0.8em;
                padding: 8px 5px;
            }
        }

        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="premium-badge" id="premiumBadge">üÜì FREE</div>
        
        <div class="header">
            <div class="logo">üß†</div>
            <h1 class="title">Brain Boost</h1>
            <p class="subtitle">Allena la tua mente con giochi divertenti e stimolanti!</p>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-label">Partite</div>
                <div class="stat-value" id="totalGames">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Record</div>
                <div class="stat-value" id="bestScore">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Monete</div>
                <div class="stat-value coins" id="coins">ü™ô 25</div>
            </div>
        </div>

        <div id="homeScreen">
            <div class="premium-offer" id="premiumOfferHome">
                <h3>üöÄ Passa a Premium!</h3>
                <p>Sblocca tutti i giochi, difficolt√† avanzate e modalit√† illimitate!</p>
                <button class="btn" onclick="showPremiumModal()">Upgrade - ‚Ç¨2.99/mese</button>
            </div>
            
            <div class="ad-banner" onclick="clickAd()" id="adBanner">
                üì± Scarica la nuova app di matematica! Clicca qui per il 50% di sconto!
            </div>

            <p style="text-align: center; margin-bottom: 20px; color: #666;">
                Scegli una categoria per iniziare:
            </p>
            
            <div class="category-grid">
                <div class="category-card" onclick="selectGame('visual')">
                    <div class="category-icon">üëÅÔ∏è</div>
                    <div class="category-title">Memoria Visiva</div>
                    <div class="category-desc">Trova le coppie nascoste e allena la tua memoria visiva</div>
                </div>
                
                <div class="category-card" onclick="selectGame('audio')">
                    <div class="category-icon">üëÇ</div>
                    <div class="category-title">Memoria Uditiva</div>
                    <div class="category-desc">Riproduci le sequenze sonore che ascolti</div>
                </div>
                
                <div class="category-card" onclick="selectGame('logic')">
                    <div class="category-icon">üß†</div>
                    <div class="category-title">Memoria Logica</div>
                    <div class="category-desc">Risolvi enigmi e problemi di logica</div>
                </div>
                
                <div class="category-card locked" id="mathCategory" onclick="checkPremiumAndShowModal('math')">
                    <div class="category-icon">üî¢</div>
                    <div class="category-title">Matematica</div>
                    <div class="category-desc">Calcoli mentali e problemi numerici</div>
                </div>
                
                <div class="category-card locked" id="geoCategory" onclick="checkPremiumAndShowModal('geo')">
                    <div class="category-icon">üåç</div>
                    <div class="category-title">Geografia</div>
                    <div class="category-desc">Capitali, bandiere e curiosit√† geografiche</div>
                </div>
                
                <div class="category-card locked" id="artCategory" onclick="checkPremiumAndShowModal('art')">
                    <div class="category-icon">üé®</div>
                    <div class="category-title">Arte & Cultura</div>
                    <div class="category-desc">Storia dell'arte e cultura generale</div>
                </div>
            </div>
        </div>

        <div id="visualGame" class="hidden">
            <div class="power-ups">
                <button class="power-up" onclick="usePowerUp('peek')" id="peekBtn">
                    üëÄ Sbircia (ü™ô 5)
                </button>
                <button class="power-up" onclick="usePowerUp('time')" id="timeBtn">
                    ‚è∞ +30s (ü™ô 8)
                </button>
            </div>

            <h3 style="text-align: center; margin-bottom: 20px;">üîç Memoria Visiva</h3>
            
            <div class="difficulty-selector">
                <button class="difficulty-btn active" onclick="setDifficulty('easy')" id="easyBtn">Facile</button>
                <button class="difficulty-btn" onclick="setDifficulty('medium')" id="mediumBtn">Medio</button>
                <button class="difficulty-btn" onclick="setDifficulty('hard')" id="hardBtn">Difficile</button>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-label">Mosse</div>
                    <div class="stat-value" id="moves">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Coppie</div>
                    <div class="stat-value" id="pairs">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Tempo</div>
                    <div class="stat-value" id="timer">0</div>
                </div>
            </div>

            <div class="game-area">
                <div id="memoryGrid" class="memory-grid"></div>
            </div>

            <div class="buttons">
                <button class="btn btn-primary" onclick="startMemoryGame()">üîÑ Nuova Partita</button>
                <button class="btn btn-secondary" onclick="goHome()">üè† Home</button>
            </div>
        </div>

        <div id="audioGame" class="hidden">
            <div class="power-ups">
                <button class="power-up" onclick="useAudioPowerUp('replay')" id="replayBtn">
                    üîÑ Riascolta (ü™ô 3)
                </button>
                <button class="power-up" onclick="useAudioPowerUp('slow')" id="slowBtn">
                    üêå Rallenta (ü™ô 5)
                </button>
            </div>

            <h3 style="text-align: center; margin-bottom: 20px;">üéµ Memoria Uditiva</h3>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-label">Livello</div>
                    <div class="stat-value" id="audioLevel">1</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Punteggio</div>
                    <div class="stat-value" id="audioScore">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Serie</div>
                    <div class="stat-value" id="audioStreak">0</div>
                </div>
            </div>

            <div class="game-area">
                <div class="simon-buttons">
                    <button class="simon-btn red" onclick="handleSimonClick(0)" data-value="1">1</button>
                    <button class="simon-btn blue" onclick="handleSimonClick(1)" data-value="2">2</button>
                    <button class="simon-btn green" onclick="handleSimonClick(2)" data-value="3">3</button>
                    <button class="simon-btn yellow" onclick="handleSimonClick(3)" data-value="4">4</button>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <div id="audioMessage">Clicca "Ascolta Sequenza" per iniziare!</div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn btn-primary" onclick="playSequence()" id="playBtn">‚ñ∂Ô∏è Ascolta Sequenza</button>
                <button class="btn btn-warning" onclick="startAudioGame()">üîÑ Nuova Partita</button>
                <button class="btn btn-secondary" onclick="goHome()">üè† Home</button>
            </div>
        </div>

        <div id="logicGame" class="hidden">
            <div class="power-ups">
                <button class="power-up" onclick="useLogicPowerUp('hint')" id="hintBtn">
                    üí° Aiuto (ü™ô 3)
                </button>
                <button class="power-up" onclick="useLogicPowerUp('fifty')" id="fiftyBtn">
                    üéØ 50/50 (ü™ô 5)
                </button>
                <button class="power-up" onclick="useLogicPowerUp('skip')" id="skipBtn">
                    ‚è≠Ô∏è Salta (ü™ô 8)
                </button>
            </div>

            <h3 style="text-align: center; margin-bottom: 20px;">üß© Memoria Logica</h3>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-label">Punteggio</div>
                    <div class="stat-value" id="logicScore">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Livello</div>
                    <div class="stat-value" id="logicLevel">1</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Corrette</div>
                    <div class="stat-value" id="logicCorrect">0</div>
                </div>
            </div>

            <div class="game-area">
                <div id="logicQuestionCard" class="question-card">
                    <div class="question" id="logicQuestionText">Clicca "Nuova Domanda" per iniziare!</div>
                    <div id="logicOptions" class="options"></div>
                </div>
                <div class="progress-bar" id="logicTimerBar">
                    <div class="progress-fill" id="logicProgressFill"></div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn btn-success" onclick="checkLogicAnswer()" id="checkBtn" style="display: none;">‚úÖ Controlla</button>
                <button class="btn btn-primary" onclick="newLogicQuestion()">‚ùì Nuova Domanda</button>
                <button class="btn btn-secondary" onclick="goHome()">üè† Home</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn active" onclick="selectGame('home')">
            <span>üè†</span>
            <span>Home</span>
        </button>
        <button class="nav-btn" onclick="selectGame('visual')">
            <span>üëÅÔ∏è</span>
            <span>Visiva</span>
        </button>
        <button class="nav-btn" onclick="selectGame('audio')">
            <span>üëÇ</span>
            <span>Uditiva</span>
        </button>
        <button class="nav-btn" onclick="selectGame('logic')">
            <span>üß†</span>
            <span>Logica</span>
        </button>
    </div>

    <div id="premiumModal" class="modal">
        <div class="modal-content">
            <h3>üöÄ Brain Boost Premium</h3>
            <p><strong>Cosa ottieni:</strong></p>
            <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
                <li>‚úÖ 6 giochi completi</li>
                <li>‚úÖ Tutte le difficolt√† sbloccate</li>
                <li>‚úÖ Power-ups illimitati</li>
                <li>‚úÖ Modalit√† sfida e tornei</li>
                <li>‚úÖ Statistiche avanzate</li>
                <li>‚úÖ Nessuna pubblicit√†</li>
                <li>‚úÖ Nuovi giochi ogni mese</li>
            </ul>
            <p><strong>Solo ‚Ç¨2.99/mese</strong></p>
            <div class="buttons">
                <button class="btn btn-primary" onclick="subscribePremium()">Sottoscrivi Ora</button>
                <button class="btn btn-secondary" onclick="closePremiumModal()">Forse dopo</button>
            </div>
        </div>
    </div>

    <div id="tutorialModal" class="modal">
        <div class="modal-content">
            <h3>üëã Benvenuto in Brain Boost!</h3>
            <p>Ecco come funziona:</p>
            <ol style="text-align: left; margin: 15px 0; padding-left: 20px;">
                <li><strong>Scegli un gioco</strong> tra memoria visiva, uditiva o logica</li>
                <li><strong>Gioca e guadagna monete</strong> per sbloccare power-up</li>
                <li><strong>Migliora i tuoi punteggi</strong> e sfida i tuoi amici</li>
                <li><strong>Sblocca nuove categorie</strong> con l'abbonamento Premium</li>
            </ol>
            <p>Pronto a iniziare?</p>
            <div class="buttons">
                <button class="btn btn-primary" onclick="closeTutorial()">Inizia a giocare!</button>
            </div>
        </div>
    </div>

    <script>
        // Dati di gioco globali
        const gameData = {
            coins: 25,
            totalGames: 0,
            bestScore: 0,
            isPremium: false,
            gamesPlayed: 0,
            maxFreeGames: 3,
            hasSeenTutorial: false
        };

        // Dati specifici per ogni gioco
        const visualGameData = {
            moves: 0,
            pairs: 0,
            timer: 0,
            difficulty: 'easy',
            cards: [],
            flippedCards: [],
            matchedPairs: 0,
            gameActive: false,
            timerInterval: null,
            canFlip: true
        };

        const audioGameData = {
            level: 1,
            score: 0,
            streak: 0,
            sequence: [],
            playerSequence: [],
            isPlaying: false,
            canPlay: false,
            audioFiles: [],
            speed: 600
        };

        const logicGameData = {
            score: 0,
            level: 1,
            correct: 0,
            currentQuestion: null,
            selectedAnswerIndex: null,
            questionsAttempted: 0,
            timer: 15,
            timerInterval: null,
            currentQuestionIndex: -1
        };

        // Cache degli elementi DOM
        const DOM = {
            coins: document.getElementById('coins'),
            totalGames: document.getElementById('totalGames'),
            bestScore: document.getElementById('bestScore'),
            premiumBadge: document.getElementById('premiumBadge'),
            premiumOfferHome: document.getElementById('premiumOfferHome'),
            adBanner: document.getElementById('adBanner'),
            homeScreen: document.getElementById('homeScreen'),
            visualGame: document.getElementById('visualGame'),
            audioGame: document.getElementById('audioGame'),
            logicGame: document.getElementById('logicGame'),
            memoryGrid: document.getElementById('memoryGrid'),
            moves: document.getElementById('moves'),
            pairs: document.getElementById('pairs'),
            timer: document.getElementById('timer'),
            audioLevel: document.getElementById('audioLevel'),
            audioScore: document.getElementById('audioScore'),
            audioStreak: document.getElementById('audioStreak'),
            audioMessage: document.getElementById('audioMessage'),
            playBtn: document.getElementById('playBtn'),
            logicScore: document.getElementById('logicScore'),
            logicLevel: document.getElementById('logicLevel'),
            logicCorrect: document.getElementById('logicCorrect'),
            logicQuestionText: document.getElementById('logicQuestionText'),
            logicOptions: document.getElementById('logicOptions'),
            checkBtn: document.getElementById('checkBtn'),
            logicProgressFill: document.getElementById('logicProgressFill'),
            premiumModal: document.getElementById('premiumModal'),
            tutorialModal: document.getElementById('tutorialModal')
        };

        // Database domande logica
        const logicQuestions = [
            {
                question: "Quale numero completa la sequenza: 2, 4, 8, 16, ?",
                options: ["24", "32", "30", "28"],
                correct: 1,
                hint: "Ogni numero √® il doppio del precedente."
            },
            {
                question: "Se tutti i gatti sono animali e tutti gli animali respirano, allora:",
                options: ["Tutti i gatti volano", "Tutti i gatti respirano", "Tutti gli animali sono gatti", "Nessuna delle precedenti"],
                correct: 1,
                hint: "Logica sillogistica: se A √® B e B √® C, allora A √® C."
            },
            {
                question: "In una famiglia, Marco √® il fratello di Anna. Anna √® la sorella di Giuseppe. Chi √® Giuseppe per Marco?",
                options: ["Cugino", "Fratello", "Zio", "Non si pu√≤ determinare"],
                correct: 1,
                hint: "Se Marco e Anna sono fratelli, e Anna e Giuseppe sono fratelli..."
            },
            {
                question: "Completa la serie: A, C, F, J, ?",
                options: ["L", "M", "N", "O"],
                correct: 3,
                hint: "L'incremento tra le lettere aumenta di uno ad ogni passo."
            },
            {
                question: "Se un orologio impiega 5 secondi per segnare le 5, quanto tempo impiegher√† per segnare le 10?",
                options: ["10 secondi", "12 secondi", "11.25 secondi", "9 secondi"],
                correct: 2,
                hint: "Calcola il tempo per intervallo tra i rintocchi, non per il numero di rintocchi totali."
            },
            {
                question: "Quale figura geometrica non appartiene al gruppo: Quadrato, Cerchio, Triangolo, Rettangolo?",
                options: ["Quadrato", "Cerchio", "Triangolo", "Rettangolo"],
                correct: 1,
                hint: "Pensa ai lati e agli angoli."
            },
            {
                question: "Un contadino ha 17 pecore. Tutte tranne 9 muoiono. Quante pecore gli restano?",
                options: ["8", "9", "17", "0"],
                correct: 1,
                hint: "√à un tranello! 'Tutte tranne 9' significa che 9 sono sopravvissute."
            },
            {
                question: "Se 'ROSSO' sta a 'STOP' come 'VERDE' sta a...?",
                options: ["GO", "VIA", "PARTI", "AVANTI"],
                correct: 0,
                hint: "Pensa ai semafori."
            },
            {
                question: "Cosa ha citt√†, ma non case; foreste, ma non alberi; e acqua, ma non pesci?",
                options: ["Un globo", "Una mappa", "Un libro", "Una nuvola"],
                correct: 1,
                hint: "√à qualcosa che consulti."
            },
            {
                question: "Sono alto quando sono giovane e basso quando sono vecchio. Cosa sono?",
                options: ["Un albero", "Una candela", "Un edificio", "Una montagna"],
                correct: 1,
                hint: "Vengo consumato con il tempo."
            },
            {
                question: "Quale parola √® l'intruso: Mela, Banana, Carota, Arancia?",
                options: ["Mela", "Banana", "Carota", "Arancia"],
                correct: 2,
                hint: "Pensa a dove crescono e a cosa sono classificate."
            },
            {
                question: "Se 3 √® il 100% di X, qual √® il 50% di X?",
                options: ["1.5", "3", "6", "0.75"],
                correct: 0,
                hint: "Se 3 √® l'intero, met√† di esso √®..."
            },
            {
                question: "C'√® un solo colore nel mio nome, ma sono fatto di molti colori. Cosa sono?",
                options: ["Arcobaleno", "Chromo", "Panda", "Cioccolato"],
                correct: 0,
                hint: "Appaio dopo la pioggia."
            }
        ];

        // Emoji per il gioco di memoria visiva
        const visualAnimals = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üêî', 'üêß', 'üê¶', 'ü¶ã', 'üê†', 'üê≥', 'üê¢', 'üêç', 'ü¶é'];

        // Funzioni di utilit√†
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function debounce(func, wait) {
            let timeout;
            return function() {
                const context = this, args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        }

        function showScreen(screenId) {
            ['homeScreen', 'visualGame', 'audioGame', 'logicGame'].forEach(id => {
                DOM[id].classList.add('hidden');
            });
            DOM[screenId].classList.remove('hidden');

            // Aggiorna la navigazione inferiore
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeNavButton = document.querySelector(`.nav-btn[onclick="selectGame('${screenId === 'homeScreen' ? 'home' : screenId.replace('Game', '').toLowerCase()}')"]`);
            if (activeNavButton) {
                activeNavButton.classList.add('active');
            }
        }

        function updateStats() {
            DOM.coins.textContent = `ü™ô ${gameData.coins}`;
            DOM.totalGames.textContent = gameData.totalGames;
            DOM.bestScore.textContent = gameData.bestScore;

            if (gameData.isPremium) {
                DOM.premiumBadge.textContent = '‚úÖ PREMIUM';
                DOM.premiumBadge.style.background = 'linear-gradient(45deg, #28a745, #1d7b34)';
                DOM.premiumOfferHome.classList.add('hidden');
                DOM.adBanner.classList.add('hidden');
                
                // Sblocca tutte le categorie
                ['math', 'geo', 'art'].forEach(category => {
                    const element = document.getElementById(`${category}Category`);
                    if (element) {
                        element.classList.remove('locked');
                        element.onclick = () => showToast(`Categoria ${category.charAt(0).toUpperCase() + category.slice(1)} sbloccata!`);
                    }
                });
            } else {
                DOM.premiumBadge.textContent = 'üÜì FREE';
                DOM.premiumBadge.style.background = 'linear-gradient(45deg, #ff6b6b, #ffd93d)';
                DOM.premiumOfferHome.classList.remove('hidden');
                DOM.adBanner.classList.remove('hidden');
                
                // Blocca le categorie premium
                ['math', 'geo', 'art'].forEach(category => {
                    const element = document.getElementById(`${category}Category`);
                    if (element) {
                        element.classList.add('locked');
                        element.onclick = () => checkPremiumAndShowModal(category);
                    }
                });
            }
            saveGameData();
        }

        function goHome() {
            showScreen('homeScreen');
            updateStats();
            resetAllGames();
        }

        function saveGameData() {
            localStorage.setItem('brainBoostGameData', JSON.stringify(gameData));
        }

        function loadGameData() {
            const savedData = localStorage.getItem('brainBoostGameData');
            if (savedData) {
                Object.assign(gameData, JSON.parse(savedData));
            }
            updateStats();
            
            // Mostra il tutorial solo al primo avvio
            if (!gameData.hasSeenTutorial) {
                showTutorial();
                gameData.hasSeenTutorial = true;
                saveGameData();
            }
        }

        function addCoins(amount) {
            gameData.coins += amount;
            showToast(`+${amount} monete!`);
            updateStats();
        }

        function deductCoins(amount) {
            if (gameData.isPremium) return true;
            if (gameData.coins >= amount) {
                gameData.coins -= amount;
                updateStats();
                return true;
            }
            showToast('Non hai abbastanza monete!');
            return false;
        }

        function clickAd() {
            if (!gameData.isPremium) {
                addCoins(5);
                showToast('Hai guadagnato 5 monete!');
            }
        }

        function showPremiumModal() {
            DOM.premiumModal.style.display = 'flex';
        }

        function closePremiumModal() {
            DOM.premiumModal.style.display = 'none';
        }

        function subscribePremium() {
            gameData.isPremium = true;
            closePremiumModal();
            updateStats();
            showToast('Congratulazioni! Hai sbloccato Brain Boost Premium!');
        }

        function checkPremiumAndShowModal(gameType) {
            if (!gameData.isPremium) {
                showPremiumModal();
            } else {
                showToast(`Categoria ${gameType.charAt(0).toUpperCase() + gameType.slice(1)} sbloccata!`);
            }
        }

        function checkGameLimit() {
            if (!gameData.isPremium && gameData.gamesPlayed >= gameData.maxFreeGames) {
                showPremiumModal();
                showToast('Limite partite gratuite raggiunto! Passa a Premium.');
                return false;
            }
            return true;
        }

        function incrementGamePlayed() {
            gameData.gamesPlayed++;
            gameData.totalGames++;
            updateStats();
        }

        function resetAllGames() {
            // Reset Visual Memory Game
            clearInterval(visualGameData.timerInterval);
            Object.assign(visualGameData, {
                moves: 0, pairs: 0, timer: 0, difficulty: 'easy',
                cards: [], flippedCards: [], matchedPairs: 0,
                gameActive: false, timerInterval: null, canFlip: true
            });
            DOM.moves.textContent = '0';
            DOM.pairs.textContent = '0';
            DOM.timer.textContent = '0';
            DOM.memoryGrid.innerHTML = '';
            document.querySelectorAll('#visualGame .difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.id === 'easyBtn') btn.classList.add('active');
            });

            // Reset Audio Memory Game
            clearInterval(audioGameData.timerInterval);
            Object.assign(audioGameData, {
                level: 1, score: 0, streak: 0, sequence: [], playerSequence: [],
                isPlaying: false, canPlay: false, audioFiles: [], speed: 600
            });
            DOM.audioLevel.textContent = '1';
            DOM.audioScore.textContent = '0';
            DOM.audioStreak.textContent = '0';
            DOM.audioMessage.textContent = 'Clicca "Ascolta Sequenza" per iniziare!';
            document.querySelectorAll('.simon-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.disabled = false;
            });
            DOM.playBtn.disabled = false;
            
            // Reset Logic Memory Game
            clearInterval(logicGameData.timerInterval);
            Object.assign(logicGameData, {
                score: 0, level: 1, correct: 0, currentQuestion: null,
                selectedAnswerIndex: null, questionsAttempted: 0, timer: 15, timerInterval: null,
                currentQuestionIndex: -1
            });
            DOM.logicScore.textContent = '0';
            DOM.logicLevel.textContent = '1';
            DOM.logicCorrect.textContent = '0';
            DOM.logicQuestionText.textContent = 'Clicca "Nuova Domanda" per iniziare!';
            DOM.logicOptions.innerHTML = '';
            DOM.checkBtn.style.display = 'none';
            DOM.logicProgressFill.style.width = '100%';
        }

        function showTutorial() {
            DOM.tutorialModal.style.display = 'flex';
        }

        function closeTutorial() {
            DOM.tutorialModal.style.display = 'none';
        }

        // Gestione della selezione del gioco
        function selectGame(gameType) {
            resetAllGames();
            if (gameType === 'home') {
                showScreen('homeScreen');
                return;
            }

            if (!checkGameLimit() && gameType !== 'home') {
                return;
            }

            switch (gameType) {
                case 'visual':
                    showScreen('visualGame');
                    startMemoryGame();
                    break;
                case 'audio':
                    showScreen('audioGame');
                    initAudioGame();
                    break;
                case 'logic':
                    showScreen('logicGame');
                    newLogicQuestion();
                    break;
            }
        }

        // --- VISUAL MEMORY GAME ---
        function setDifficulty(level) {
            if (!gameData.isPremium && level !== 'easy') {
                showPremiumModal();
                return;
            }
            visualGameData.difficulty = level;
            document.querySelectorAll('#visualGame .difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`${level}Btn`).classList.add('active');
            startMemoryGame();
        }

        function generateMemoryCards() {
            let numPairs, gridColumns;
            switch (visualGameData.difficulty) {
                case 'easy':
                    numPairs = 6;
                    gridColumns = 4;
                    break;
                case 'medium':
                    numPairs = 9;
                    gridColumns = 6;
                    break;
                case 'hard':
                    numPairs = 12;
                    gridColumns = 6;
                    break;
            }

            const selectedAnimals = [...visualAnimals]
                .sort(() => 0.5 - Math.random())
                .slice(0, numPairs);
            
            let cardsContent = [...selectedAnimals, ...selectedAnimals]
                .sort(() => 0.5 - Math.random());

            visualGameData.cards = cardsContent.map((animal, index) => ({
                id: index,
                animal,
                isFlipped: false,
                isMatched: false
            }));

            DOM.memoryGrid.innerHTML = '';
            DOM.memoryGrid.style.gridTemplateColumns = `repeat(${gridColumns}, 1fr)`;

            visualGameData.cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'memory-card';
                cardElement.dataset.id = card.id;
                cardElement.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">?</div>
                        <div class="card-back">${card.animal}</div>
                    </div>
                `;
                cardElement.addEventListener('click', debounce(() => flipCard(card.id), 300));
                DOM.memoryGrid.appendChild(cardElement);
            });
        }

        function startMemoryGame() {
            if (!checkGameLimit()) return;
            incrementGamePlayed();

            Object.assign(visualGameData, {
                moves: 0,
                pairs: 0,
                timer: 0,
                flippedCards: [],
                matchedPairs: 0,
                gameActive: true,
                canFlip: true
            });
            
            DOM.moves.textContent = '0';
            DOM.pairs.textContent = '0';
            DOM.timer.textContent = '0';

            clearInterval(visualGameData.timerInterval);
            visualGameData.timerInterval = setInterval(() => {
                visualGameData.timer++;
                DOM.timer.textContent = visualGameData.timer;
            }, 1000);

            generateMemoryCards();
        }

        function flipCard(id) {
            if (!visualGameData.gameActive || !visualGameData.canFlip || visualGameData.flippedCards.length === 2) return;

            const cardIndex = visualGameData.cards.findIndex(card => card.id === id);
            const card = visualGameData.cards[cardIndex];
            const cardElement = document.querySelector(`.memory-card[data-id="${id}"]`);

            if (card.isFlipped || card.isMatched) return;

            card.isFlipped = true;
            cardElement.classList.add('flipped');
            visualGameData.flippedCards.push(card);
            
            if (visualGameData.flippedCards.length === 1) {
                visualGameData.moves++;
                DOM.moves.textContent = visualGameData.moves;
            }

            if (visualGameData.flippedCards.length === 2) {
                visualGameData.canFlip = false;
                const [card1, card2] = visualGameData.flippedCards;

                if (card1.animal === card2.animal) {
                    card1.isMatched = true;
                    card2.isMatched = true;
                    document.querySelector(`.memory-card[data-id="${card1.id}"]`).classList.add('matched');
                    document.querySelector(`.memory-card[data-id="${card2.id}"]`).classList.add('matched');
                    visualGameData.matchedPairs++;
                    DOM.pairs.textContent = visualGameData.matchedPairs;
                    visualGameData.flippedCards = [];
                    visualGameData.canFlip = true;
                    addCoins(2);

                    if (visualGameData.matchedPairs === visualGameData.cards.length / 2) {
                        endMemoryGame();
                    }
                } else {
                    setTimeout(() => {
                        card1.isFlipped = false;
                        card2.isFlipped = false;
                        document.querySelector(`.memory-card[data-id="${card1.id}"]`).classList.remove('flipped');
                        document.querySelector(`.memory-card[data-id="${card2.id}"]`).classList.remove('flipped');
                        visualGameData.flippedCards = [];
                        visualGameData.canFlip = true;
                    }, 800);
                }
            }
        }

        function endMemoryGame() {
            visualGameData.gameActive = false;
            clearInterval(visualGameData.timerInterval);
            showToast(`Partita terminata! Mosse: ${visualGameData.moves}, Tempo: ${visualGameData.timer}s`);

            const currentScore = visualGameData.moves + visualGameData.timer;
            if (gameData.bestScore === 0 || currentScore < gameData.bestScore) {
                gameData.bestScore = currentScore;
                updateStats();
            }
        }

        function usePowerUp(powerUpType) {
            if (!visualGameData.gameActive) {
                showToast('Inizia una partita prima di usare i power-up!');
                return;
            }

            if (powerUpType === 'peek' && deductCoins(5)) {
                visualGameData.canFlip = false;
                visualGameData.cards.forEach(card => {
                    if (!card.isMatched) {
                        const cardElement = document.querySelector(`.memory-card[data-id="${card.id}"]`);
                        cardElement.classList.add('flipped');
                    }
                });
                setTimeout(() => {
                    visualGameData.cards.forEach(card => {
                        if (!card.isMatched && !visualGameData.flippedCards.includes(card)) {
                            const cardElement = document.querySelector(`.memory-card[data-id="${card.id}"]`);
                            cardElement.classList.remove('flipped');
                        }
                    });
                    visualGameData.canFlip = true;
                }, 1500);
            } else if (powerUpType === 'time' && deductCoins(8)) {
                visualGameData.timer = Math.max(0, visualGameData.timer - 30);
                DOM.timer.textContent = visualGameData.timer;
                showToast('+30 secondi di tempo rimosso!');
            }
        }

        // --- AUDIO MEMORY GAME ---
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const frequencies = {
            '1': 261.63,
            '2': 293.66,
            '3': 329.63,
            '4': 349.23
        };
        const buttonValues = ['1', '2', '3', '4'];

        function initAudioGame() {
            const simonButtons = document.querySelectorAll('.simon-btn');
            simonButtons.forEach((btn, index) => {
                btn.textContent = buttonValues[index];
                btn.dataset.value = buttonValues[index];
            });

            if (audioGameData.audioFiles.length === 0) {
                buttonValues.forEach(value => {
                    audioGameData.audioFiles.push(createOscillator(frequencies[value]));
                });
            }
        }

        function createOscillator(frequency) {
            return function(duration = 300) {
                const oscillator = audioContext.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration / 1000);

                oscillator.connect(gainNode).connect(audioContext.destination);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + duration / 1000);
            };
        }

        function startAudioGame() {
            if (!checkGameLimit()) return;
            incrementGamePlayed();

            Object.assign(audioGameData, {
                level: 1,
                score: 0,
                streak: 0,
                sequence: [],
                playerSequence: [],
                isPlaying: false,
                canPlay: false,
                speed: 600
            });

            DOM.audioLevel.textContent = '1';
            DOM.audioScore.textContent = '0';
            DOM.audioStreak.textContent = '0';
            DOM.audioMessage.textContent = 'Clicca "Ascolta Sequenza" per iniziare!';
            
            document.querySelectorAll('.simon-btn').forEach(btn => btn.disabled = true);
            DOM.playBtn.disabled = false;
        }

        function nextAudioRound() {
            audioGameData.playerSequence = [];
            audioGameData.isPlaying = true;
            audioGameData.canPlay = false;
            DOM.audioMessage.textContent = `Livello ${audioGameData.level} - Ascolta...`;
            audioGameData.sequence.push(Math.floor(Math.random() * 4)); 
            playSequence();
        }

        async function playSequence() {
            DOM.playBtn.disabled = true;
            document.querySelectorAll('.simon-btn').forEach(btn => btn.disabled = true);
            
            for (let i = 0; i < audioGameData.sequence.length; i++) {
                const buttonIndex = audioGameData.sequence[i];
                const button = document.querySelectorAll('.simon-btn')[buttonIndex];
                
                button.classList.add('active');
                audioGameData.audioFiles[buttonIndex](audioGameData.speed * 0.8);
                
                await new Promise(resolve => setTimeout(() => {
                    button.classList.remove('active');
                    setTimeout(resolve, audioGameData.speed * 0.2);
                }, audioGameData.speed * 0.8));
            }

            audioGameData.isPlaying = false;
            audioGameData.canPlay = true;
            DOM.audioMessage.textContent = 'Riproduci la sequenza!';
            document.querySelectorAll('.simon-btn').forEach(btn => btn.disabled = false);
        }

        function handleSimonClick(buttonIndex) {
            if (audioGameData.isPlaying || !audioGameData.canPlay) return;

            audioGameData.playerSequence.push(buttonIndex);
            
            const button = document.querySelectorAll('.simon-btn')[buttonIndex];
            button.classList.add('active');
            audioGameData.audioFiles[buttonIndex](200);
            setTimeout(() => button.classList.remove('active'), 200);

            checkPlayerSequence();
        }

        function checkPlayerSequence() {
            const currentStep = audioGameData.playerSequence.length - 1;

            if (audioGameData.playerSequence[currentStep] !== audioGameData.sequence[currentStep]) {
                showToast(`Game Over! Livello raggiunto: ${audioGameData.level}`);
                if (audioGameData.level - 1 > gameData.bestScore) {
                    gameData.bestScore = audioGameData.level - 1;
                    updateStats();
                }
                startAudioGame();
                return;
            }

            if (audioGameData.playerSequence.length === audioGameData.sequence.length) {
                audioGameData.score += audioGameData.level * 10;
                audioGameData.streak++;
                audioGameData.level++;
                addCoins(audioGameData.level);

                if (audioGameData.speed > 200) {
                    audioGameData.speed -= 50;
                }

                DOM.audioScore.textContent = audioGameData.score;
                DOM.audioStreak.textContent = audioGameData.streak;
                DOM.audioLevel.textContent = audioGameData.level;
                
                DOM.audioMessage.textContent = 'Corretto! Prossimo livello...';
                audioGameData.canPlay = false;
                document.querySelectorAll('.simon-btn').forEach(btn => btn.disabled = true);
                setTimeout(nextAudioRound, 1000);
            }
        }

        function useAudioPowerUp(powerUpType) {
            if (audioGameData.isPlaying || !audioGameData.canPlay) {
                showToast('Attendi il tuo turno per usare i power-up!');
                return;
            }

            if (powerUpType === 'replay' && deductCoins(3)) {
                DOM.audioMessage.textContent = 'Riascolta la sequenza...';
                playSequence();
            } else if (powerUpType === 'slow' && deductCoins(5)) {
                audioGameData.speed = Math.min(1000, audioGameData.speed + 200);
                showToast('Sequenza rallentata!');
                playSequence();
            }
            
            const button = document.getElementById(`${powerUpType}Btn`);
            button.disabled = true;
            setTimeout(() => button.disabled = false, 3000);
        }

        // --- LOGIC MEMORY GAME ---
        function newLogicQuestion() {
            if (!checkGameLimit()) {
                DOM.logicQuestionText.textContent = 'Passa a Premium per giocare illimitatamente!';
                DOM.logicOptions.innerHTML = '';
                DOM.checkBtn.style.display = 'none';
                return;
            }

            DOM.checkBtn.style.display = 'none';
            DOM.logicOptions.innerHTML = '';
            DOM.logicQuestionCard.classList.remove('correct', 'incorrect');
            
            logicGameData.selectedAnswerIndex = null;
            clearInterval(logicGameData.timerInterval);

            let questionIndex;
            do {
                questionIndex = Math.floor(Math.random() * logicQuestions.length);
            } while (questionIndex === logicGameData.currentQuestionIndex && logicQuestions.length > 1);

            logicGameData.currentQuestion = logicQuestions[questionIndex];
            logicGameData.currentQuestionIndex = questionIndex;
            logicGameData.questionsAttempted++;

            DOM.logicQuestionText.textContent = logicGameData.currentQuestion.question;

            logicGameData.currentQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                optionElement.addEventListener('click', () => selectLogicOption(index));
                DOM.logicOptions.appendChild(optionElement);
            });

            logicGameData.timer = 15;
            DOM.logicProgressFill.style.width = '100%';
            logicGameData.timerInterval = setInterval(updateLogicTimer, 1000);
            updateStats();
        }

        function selectLogicOption(index) {
            if (logicGameData.selectedAnswerIndex !== null && DOM.checkBtn.style.display === 'block') return;

            document.querySelectorAll('#logicOptions .option').forEach(option => {
                option.classList.remove('selected');
            });
            const selectedOptionElement = document.querySelector(`#logicOptions .option[data-index="${index}"]`);
            selectedOptionElement.classList.add('selected');
            logicGameData.selectedAnswerIndex = index;
            DOM.checkBtn.style.display = 'block';
        }

        function checkLogicAnswer() {
            if (logicGameData.selectedAnswerIndex === null) {
                showToast('Seleziona una risposta prima!');
                return;
            }

            clearInterval(logicGameData.timerInterval);

            const selectedOptionElement = document.querySelector(`#logicOptions .option[data-index="${logicGameData.selectedAnswerIndex}"]`);
            const correctAnswerIndex = logicGameData.currentQuestion.correct;
            const correctAnswerElement = document.querySelector(`#logicOptions .option[data-index="${correctAnswerIndex}"]`);

            document.querySelectorAll('#logicOptions .option').forEach(option => {
                option.style.pointerEvents = 'none';
            });

            if (logicGameData.selectedAnswerIndex === correctAnswerIndex) {
                selectedOptionElement.classList.add('correct');
                logicGameData.score += 10;
                logicGameData.correct++;
                addCoins(5);
                if (logicGameData.correct % 5 === 0) {
                    logicGameData.level++;
                    showToast(`Livello ${logicGameData.level} sbloccato!`);
                }
            } else {
                selectedOptionElement.classList.add('incorrect');
                correctAnswerElement.classList.add('correct');
                logicGameData.score = Math.max(0, logicGameData.score - 5);
                showToast('Risposta sbagliata!');
            }

            DOM.logicScore.textContent = logicGameData.score;
            DOM.logicCorrect.textContent = logicGameData.correct;
            DOM.logicLevel.textContent = logicGameData.level;
            
            DOM.checkBtn.style.display = 'none';
        }

        function updateLogicTimer() {
            logicGameData.timer--;
            const progress = (logicGameData.timer / 15) * 100;
            DOM.logicProgressFill.style.width = `${progress}%`;

            if (logicGameData.timer <= 0) {
                clearInterval(logicGameData.timerInterval);
                showToast('Tempo scaduto!');
                const correctAnswerIndex = logicGameData.currentQuestion.correct;
                const correctAnswerElement = document.querySelector(`#logicOptions .option[data-index="${correctAnswerIndex}"]`);
                if (correctAnswerElement) {
                    correctAnswerElement.classList.add('correct');
                }
                document.querySelectorAll('#logicOptions .option').forEach(option => {
                    option.style.pointerEvents = 'none';
                });
                logicGameData.score = Math.max(0, logicGameData.score - 5);
                DOM.logicScore.textContent = logicGameData.score;
                DOM.checkBtn.style.display = 'none';
            }
        }

        function useLogicPowerUp(powerUpType) {
            if (!logicGameData.currentQuestion || DOM.checkBtn.style.display === 'block') {
                showToast('Inizia una domanda o attendi per usare i power-up!');
                return;
            }

            if (powerUpType === 'hint' && deductCoins(3)) {
                showToast('Suggerimento: ' + logicGameData.currentQuestion.hint);
            } else if (powerUpType === 'fifty' && deductCoins(5)) {
                const options = document.querySelectorAll('#logicOptions .option');
                const correctAnswerIndex = logicGameData.currentQuestion.correct;
                let removedCount = 0;
                
                const incorrectOptions = Array.from(options).filter(
                    (option, index) => index !== correctAnswerIndex
                );

                while (removedCount < 2 && incorrectOptions.length > 0) {
                    const randomIndex = Math.floor(Math.random() * incorrectOptions.length);
                    const optionToRemove = incorrectOptions.splice(randomIndex, 1)[0];
                    if (parseInt(optionToRemove.dataset.index) !== correctAnswerIndex) {
                        optionToRemove.style.opacity = '0.3';
                        optionToRemove.style.pointerEvents = 'none';
                        removedCount++;
                    }
                }
                showToast('Due risposte sbagliate rimosse!');
            } else if (powerUpType === 'skip' && deductCoins(8)) {
                showToast('Domanda saltata!');
                newLogicQuestion();
            }
            
            const button = document.getElementById(`${powerUpType}Btn`);
            button.disabled = true;
            setTimeout(() => button.disabled = false, 3000);
        }

        // Inizializzazione all'avvio
        document.addEventListener('DOMContentLoaded', () => {
            loadGameData();
            goHome();
            initAudioGame();
        });
    </script>
</body>
</html>
